tosca_definitions_version: cloudify_dsl_1_4

imports:
  - https://cloudify.co/spec/cloudify/6.4.0/types.yaml
  - plugin:cloudify-vault-plugin

inputs:

  secret_key:
    type: string
    default: testrole

  mount_point:
    type: string
    default: aws/roles
  
  secret_value:
    type: dict
    default:
      credential_type: iam_user

dsl_definitions:

  vault_config: &vault_config
    url: { get_secret: vault_url }
    token: { get_secret: vault_token }

node_templates:

  install_vault_secrets:
    type:  cloudify.nodes.vault.Secret
    properties:
      client_config: *vault_config
      use_external_resource: False
      resource_config:
        create_secret: true
        mount_point: {get_input: mount_point}
        secret_key: {get_input: secret_key}
        secret_value: {get_input: secret_value}

